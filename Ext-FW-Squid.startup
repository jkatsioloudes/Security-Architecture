# External Firewall with Squid Proxy responsible
# for SNAT and DNAT. It acts as the first layer of
# defence and filters packets before they enter
# the DMZ.

ifconfig eth0 137.205.0.1/16
ifconfig eth1 172.16.0.1/30
ifconfig eth2 10.0.0.1/30
ifconfig eth3 192.168.0.1/30


# Adding networks that are accessible through
# directly connected gateways including the 
# Internet, DMZ-GW-VPN, DMZ-GW-Mail and Int-FW.
# Accessible components are the Ext-Hostile,
# Ext-Office, Ext-DNS, Ext-WWW, OpenVPN, Mail
# and GW-Staff. 

# OpenVPN Server accessible though the DMZ Gateway VPN.
route add -net 172.16.1.0/30 gw 172.16.0.2

# Mail Server accessible though the DMZ Gateway Mail.
route add -net 192.168.1.0/30 gw 192.168.0.2

# WBS LAN accessible through the Internal Firewall.
route add -net 10.0.5.0/24 gw 10.0.0.2

# WMG LAN accessible through the Internal Firewall.
route add -net 10.0.7.0/24 gw 10.0.0.2

# Public Internet is the Default route of the External Firewall.
route add default gw 137.205.0.2


# Firewall Rules

iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source 137.205.0.1


# Squid Proxy

touch /var/log/squid/access.log
chmod 777 /var/log/squid/access.log
service squid start
